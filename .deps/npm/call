/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/call@5.0.3/lib/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";const Hoek=require("hoek"),Boom=require("boom"),Regex=require("./regex"),Segment=require("./segment"),internals={pathRegex:Regex.generate(),defaults:{isCaseSensitive:!0}};exports.Router=internals.Router=function(t){this.settings=Hoek.applyToDefaults(internals.defaults,t||{}),this.routes={},this.ids={},this.vhosts=null,this.specials={badRequest:null,notFound:null,options:null}},internals.Router.prototype.add=function(t,e){const s=t.method.toLowerCase(),n=t.vhost||"*";"*"!==n&&(this.vhosts=this.vhosts||{},this.vhosts[n]=this.vhosts[n]||{});const r="*"===n?this.routes:this.vhosts[n];r[s]=r[s]||{routes:[],router:new Segment};const o=t.analysis||this.analyze(t.path),i={path:t.path,route:e||t.path,segments:o.segments,params:o.params,fingerprint:o.fingerprint,settings:this.settings};r[s].router.add(o.segments,i),r[s].routes.push(i),r[s].routes.sort(internals.sort);return i.segments[i.segments.length-1].empty&&r[s].router.add(o.segments.slice(0,-1),i),t.id&&(Hoek.assert(!this.ids[t.id],"Route id",t.id,"for path",t.path,"conflicts with existing path",this.ids[t.id]&&this.ids[t.id].path),this.ids[t.id]=i),i},internals.Router.prototype.special=function(t,e){Hoek.assert(-1!==Object.keys(this.specials).indexOf(t),"Unknown special route type:",t),this.specials[t]={route:e}},internals.Router.prototype.route=function(t,e,s){const n=e.split("/").slice(1),r=this.vhosts&&s&&this.vhosts[s];return r&&this._lookup(e,n,r,t)||this._lookup(e,n,this.routes,t)||"head"===t&&r&&this._lookup(e,n,r,"get")||"head"===t&&this._lookup(e,n,this.routes,"get")||"options"===t&&this.specials.options||r&&this._lookup(e,n,r,"*")||this._lookup(e,n,this.routes,"*")||this.specials.notFound||Boom.notFound()},internals.Router.prototype._lookup=function(t,e,s,n){const r=s[n];if(!r)return null;const o=r.router.lookup(t,e,this.settings);if(!o)return null;const i={},a=[];for(let t=0;t<o.array.length;++t){const e=o.record.params[t],s=internals.decode(o.array[t]);if(s.isBoom)return this.specials.badRequest||s;void 0!==i[e]?i[e]=i[e]+"/"+s:i[e]=s,t+1!==o.array.length&&e===o.record.params[t+1]||a.push(i[e])}return{params:i,paramsArray:a,route:o.record.route}},internals.decode=function(t){try{return decodeURIComponent(t)}catch(t){return Boom.badRequest("Invalid request path")}},internals.Router.prototype.normalize=function(t){if(t&&-1!==t.indexOf("%")){const e=t.replace(/%[0-9a-fA-F][0-9a-fA-F]/g,(t=>t.toUpperCase()));t=e.replace(/%(?:2[146-9A-E]|3[\dABD]|4[\dA-F]|5[\dAF]|6[1-9A-F]|7[\dAE])/g,(t=>String.fromCharCode(parseInt(t.substring(1),16))))}if(t&&(-1!==t.indexOf("/.")||"."===t[0])){const e="/"===t[0],s=t.split("/"),n=[];let r;for(let t=0;t<s.length;++t)r=s[t],".."===r?n.pop():"."!==r&&n.push(r);"."!==r&&".."!==r||n.push(""),"/"!==(t=n.join("/"))[0]&&e&&(t="/"+t)}return t},internals.Router.prototype.analyze=function(t){Hoek.assert(internals.pathRegex.validatePath.test(t),"Invalid path:",t),Hoek.assert(!internals.pathRegex.validatePathEncoded.test(t),"Path cannot contain encoded non-reserved path characters:",t);const e=t.split("/"),s=[],n=[],r=[];for(let o=1;o<e.length;++o){let i=e[o];if(-1===i.indexOf("{")){i=this.settings.isCaseSensitive?i:i.toLowerCase(),r.push(i),s.push({literal:i});continue}const a=internals.parseParams(i);if(1===a.length){const e=a[0];if(Hoek.assert(-1===n.indexOf(e.name),"Cannot repeat the same parameter name:",e.name,"in:",t),n.push(e.name),e.wilcard)if(e.count)for(let t=0;t<e.count;++t)r.push("?"),s.push({}),t&&n.push(e.name);else r.push("#"),s.push({wildcard:!0});else r.push("?"),s.push({empty:e.empty})}else{const e={length:a.length,first:"string"!=typeof a[0],segments:[]};let o="",i="^";for(let s=0;s<a.length;++s){const r=a[s];"string"==typeof r?(o+=r,i+=Hoek.escapeRegex(r),e.segments.push(r)):(Hoek.assert(-1===n.indexOf(r.name),"Cannot repeat the same parameter name:",r.name,"in:",t),n.push(r.name),o+="?",i=i+"(."+(r.empty?"*":"+")+")")}e.mixed=new RegExp(i+"$",this.settings.isCaseSensitive?"":"i"),r.push(o),s.push(e)}}return{segments:s,fingerprint:"/"+r.join("/"),params:n}},internals.parseParams=function(t){const e=[];return t.replace(internals.pathRegex.parseParam,((t,s,n,r,o,i)=>(s?e.push(s):e.push({name:n,wilcard:!!r,count:o&&parseInt(o,10),empty:!!i}),""))),e},internals.Router.prototype.table=function(t){const e=[],s=t=>{t&&Object.keys(t).forEach((s=>{t[s].routes.forEach((t=>{e.push(t.route)}))}))};if(this.vhosts){const e=t?[].concat(t):Object.keys(this.vhosts);for(let t=0;t<e.length;++t)s(this.vhosts[e[t]])}return s(this.routes),e},internals.sort=function(t,e){const s=t.segments,n=e.segments;if(s.length!==n.length)return s.length>n.length?1:-1;for(let t=0;;++t){if(s[t].literal){if(n[t].literal){if(s[t].literal===n[t].literal)continue;return s[t].literal>n[t].literal?1:-1}return-1}return n[t].literal||s[t].wildcard?1:-1}};
//# sourceMappingURL=/sm/124a3bdc8717092acb8dc7a423f5db98159dd5db010fda711b3f88622fca30d9.map